"use strict";!function(){var a=document.getElementById("output-area"),b=document.getElementById("what-to-do"),c=document.getElementById("add-to-do"),d=document.getElementById("hide-if-done"),e=document.getElementById("show-deleted"),f=document.getElementById("hide-deleted"),g=void 0,h=void 0,i=[],j={getDate:function(){var a=new Date;return a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()},closest:function(a,b){for(var c=a;-1===c.className.replace(/[\n\t]/g," ").indexOf(b);){if("html"===c.tagName.toLowerCase())return!1;c=c.parentNode}return c},uuid:function m(){var a=void 0,b=void 0,m="";for(a=0;32>a;a++)b=16*Math.random()|0,8!==a&&12!==a&&16!==a&&20!==a||(m+="-"),m+=(12===a?4:16===a?3&b|8:b).toString(16);return m}},k={init:function(){document.getElementById("current-date").innerHTML=j.getDate(),this.loadFromLocalStorage(),l.drawTasks(),this.initControlButtons(),this.addEventListeners()},initControlButtons:function(){g&&d.classList.add("hide-if-done-button-red"),h?(b.classList.add("display-for-buttons-none"),c.classList.add("display-for-buttons-none"),d.classList.add("display-for-buttons-none"),e.classList.add("display-for-buttons-none"),f.classList.add("display-for-buttons-inline")):f.classList.add("display-for-buttons-none")},getClasses:function(a){var b="";return a.done&&(b+=" done"),a.deleted&&(b+=" deleted"),a.hide&&(b+=" hide-task"),b},addEventListeners:function(){c.addEventListener("click",k.addTask),d.addEventListener("click",k.hideIfDone),e.addEventListener("click",k.showDeletedTasks),f.addEventListener("click",k.hideDeletedTasks),a.addEventListener("click",function(a){var b=a.target;b.classList.contains("button-done")&&l.toggleDone(b),b.classList.contains("out-span")&&l.changeTask(b),b.classList.contains("button-delete")&&l.deleteTask(b),b.classList.contains("button-return")&&l.returnTaskFromBasket(b),b.classList.contains("button-finally-delete")&&l.finallyDeleteTask(b)})},saveInLocalStorage:function(){localStorage.setItem("tasks",JSON.stringify(i))},loadFromLocalStorage:function(){localStorage.getItem("tasks")&&(i=JSON.parse(localStorage.getItem("tasks"))),g=localStorage.getItem("hideToggle"),g=g?"true"===g:!1,h=localStorage.getItem("inBasket"),h=h?"true"===h:!1},indexFromEl:function(a){for(var b=j.closest(a,"output").id,c=i.length;c--;)if(i[c].id===b)return c},addTask:function(){""===b.value&&(b.value="&nbsp;"),i.push({description:b.value,done:!1,deleted:!1,hide:!1,id:j.uuid()}),b.value="",l.drawTasks(),k.saveInLocalStorage()},hideIfDone:function(){this.classList.toggle("hide-if-done-button-red"),g=!g,i.forEach(function(a){a.done&&(a.hide=!a.hide)}),localStorage.setItem("hideToggle",g),l.drawTasks(),k.saveInLocalStorage()},toggleDisplayForButtons:function(){b.classList.toggle("display-for-buttons-none"),c.classList.toggle("display-for-buttons-none"),d.classList.toggle("display-for-buttons-none"),e.classList.toggle("display-for-buttons-none"),f.classList.toggle("display-for-buttons-inline")},showDeletedTasks:function(){k.toggleDisplayForButtons(),i.forEach(function(a){a.hide=!0,a.deleted&&(a.hide=!1)}),localStorage.setItem("inBasket",!0),l.drawTasks(),k.saveInLocalStorage()},hideDeletedTasks:function(){k.toggleDisplayForButtons(),i.forEach(function(a){a.hide=!1,a.deleted&&(a.hide=!0),g&&a.done&&(a.hide=!0)}),localStorage.setItem("inBasket",!1),l.drawTasks(),k.saveInLocalStorage()}},l={drawTasks:function(){var b="";i.forEach(function(a){b+='<li class="clearfix output'+k.getClasses(a)+'" id='+a.id+'>\n                             <label class="out-label">\n                               <input type="text" class="out-input hide" value="'+a.description+'">\n                               <span class="out-span">'+a.description+'</span>\n                              </label>\n                              <div class="button-done">&#10004;</div><div class="button-delete">&#10006;</div>\n                              <div class="button-finally-delete">&#10006;</div><div class="button-return">&#8634;</div>\n                           </li>'}),a.innerHTML=b},toggleDone:function(a){var b=k.indexFromEl(a);i[b].done=!i[b].done,i[b].done&&g&&(i[b].hide=!0),this.drawTasks(),k.saveInLocalStorage()},changeTask:function(a){var b=a,c=j.closest(a,"output").getElementsByClassName("out-input")[0];c.classList.remove("hide"),b.classList.add("hide"),c.focus(),c.selectionStart=c.value.length,c.onblur=function(){c.classList.add("hide"),b.classList.remove("hide"),""===c.value&&(c.value="&nbsp;");var d=j.closest(a,"output"),e=k.indexFromEl(d);i[e].description=c.value,l.drawTasks(),k.saveInLocalStorage()}},deleteTask:function(a){var b=k.indexFromEl(a);i[b].hide=!0,i[b].deleted=!0,i[b].done=!1,this.drawTasks(),k.saveInLocalStorage()},returnTaskFromBasket:function(a){var b=k.indexFromEl(a);i[b].deleted=!1,i[b].hide=!0,this.drawTasks(),k.saveInLocalStorage()},finallyDeleteTask:function(a){if(confirm("Вы правда хотите окончательно удалить дело?")){var b=k.indexFromEl(a);i.splice(b,1),this.drawTasks(),k.saveInLocalStorage()}}};k.init()}();